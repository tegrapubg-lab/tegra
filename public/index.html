<!DOCTYPE html>
<html lang="uz">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Discord-lite - Elvitsa.com</title>
<style>
body{margin:0;padding:0;font-family:Segoe UI,Tahoma,Verdana,sans-serif;display:flex;height:100vh;background:#1e1e2f;color:#fff}
#login{display:flex;flex-direction:column;align-items:center;justify-content:center;flex:1}
#login h2{margin-bottom:20px;color:#ff6b81}
#login input{padding:10px 15px;border:none;border-radius:8px;margin-bottom:10px;width:250px;font-size:16px}
#login button{padding:10px 20px;background:#ff6b81;border:none;border-radius:8px;cursor:pointer;font-weight:bold;color:white;transition:0.3s}
#login button:hover{background:#ff4b61}
#chat-container{display:none;flex:1;flex-direction:row}
#chat-panel{width:300px;background:#2c2c3e;display:flex;flex-direction:column;border-right:1px solid #444}
#messages{flex:1;padding:10px;overflow-y:auto;scroll-behavior:smooth}
#messages div{margin-bottom:10px;padding:5px 10px;border-radius:12px;background:#3b3b50;word-break:break-word}
#input{display:flex;padding:10px;background:#2c2c3e}
#input input{flex:1;padding:10px 15px;border-radius:8px;border:none;margin-right:5px;background:#3b3b50;color:#fff}
#input button{padding:10px 15px;border:none;border-radius:8px;background:#ff6b81;cursor:pointer;color:white}
#input button:hover{background:#ff4b61}
#video-panel{flex:1;display:flex;flex-direction:column;padding:10px;gap:10px;overflow-y:auto;justify-content:flex-start;align-items:flex-start}
.video-card{position:relative;background:#111;border-radius:12px;overflow:hidden;width:320px;height:180px;box-shadow:0 2px 10px rgba(0,0,0,0.5)}
.video-card video{width:100%;height:100%;object-fit:cover;border-radius:12px}
.video-card span{position:absolute;bottom:5px;left:5px;background:rgba(0,0,0,0.5);padding:2px 6px;border-radius:6px;font-size:12px;color:#fff}
#controls{display:flex;gap:10px;margin-bottom:10px}
#controls button{padding:10px 15px;border:none;border-radius:8px;background:#ff6b81;cursor:pointer;color:white}
#controls button:hover{background:#ff4b61}
#messages::-webkit-scrollbar,#video-panel::-webkit-scrollbar{width:8px}
#messages::-webkit-scrollbar-thumb,#video-panel::-webkit-scrollbar-thumb{background:#ff6b81;border-radius:4px}
</style>
</head>
<body>
<div id="login">
<h2>Ismingizni kiriting:</h2>
<input type="text" id="nickInput" placeholder="Nick">
<button id="joinBtn">Kirish</button>
</div>
<div id="chat-container">
<div id="chat-panel">
<div id="messages"></div>
<div id="input">
<input type="text" id="messageInput" placeholder="Xabar yozing...">
<button id="sendBtn">Yuborish</button>
</div>
</div>
<div id="video-panel">
<div id="controls">
<button id="startVideoBtn">Video + Audio</button>
<button id="shareScreenBtn">Ekran ulash</button>
</div>
</div>
</div>
<script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
<script>
const socket=io('https://elvitsa.com'); // domeningiz bilan
let peers={},localStream,nick='';
const loginDiv=document.getElementById('login');
const chatDiv=document.getElementById('chat-container');
const nickInput=document.getElementById('nickInput');
const joinBtn=document.getElementById('joinBtn');
const messagesDiv=document.getElementById('messages');
const messageInput=document.getElementById('messageInput');
const sendBtn=document.getElementById('sendBtn');
const startVideoBtn=document.getElementById('startVideoBtn');
const shareScreenBtn=document.getElementById('shareScreenBtn');
const videoPanel=document.getElementById('video-panel');
joinBtn.onclick=()=>{nick=nickInput.value.trim();if(nick){loginDiv.style.display='none';chatDiv.style.display='flex';socket.emit('join',nick)}};
sendBtn.onclick=()=>{const msg=messageInput.value.trim();if(msg){socket.emit('chat',{nick,msg});messageInput.value=''}};
socket.on('chat',data=>{const el=document.createElement('div');el.textContent=data.nick+': '+data.msg;messagesDiv.appendChild(el);messagesDiv.scrollTop=messagesDiv.scrollHeight});
async function startMedia(){
localStream=await navigator.mediaDevices.getUserMedia({video:{width:3840,height:2160,frameRate:60},audio:true});
addVideo(localStream,nick);socket.emit('ready');
socket.on('new-peer',async({id})=>{const pc=new RTCPeerConnection();localStream.getTracks().forEach(track=>pc.addTrack(track,localStream));pc.onicecandidate=e=>{if(e.candidate)socket.emit('signal',{to:id,signal:{candidate:e.candidate}})};pc.ontrack=e=>addVideo(e.streams[0],'Peer');const offer=await pc.createOffer();await pc.setLocalDescription(offer);socket.emit('signal',{to:id,signal:{sdp:offer}});peers[id]=pc});
socket.on('signal',async({from,signal})=>{let pc=peers[from];if(!pc){pc=new RTCPeerConnection();localStream.getTracks().forEach(track=>pc.addTrack(track,localStream));pc.ontrack=e=>addVideo(e.streams[0],'Peer');pc.onicecandidate=e=>{if(e.candidate)socket.emit('signal',{to:from,signal:{candidate:e.candidate}})};peers[from]=pc}if(signal.sdp){await pc.setRemoteDescription(signal.sdp);if(signal.sdp.type==='offer'){const answer=await pc.createAnswer();await pc.setLocalDescription(answer);socket.emit('signal',{to:from,signal:{sdp:answer}})}}else if(signal.candidate){pc.addIceCandidate(new RTCIceCandidate(signal.candidate))}});
}
startVideoBtn.onclick=startMedia;
shareScreenBtn.onclick=async()=>{const screenStream=await navigator.mediaDevices.getDisplayMedia({video:{width:3840,height:2160,frameRate:60}});addVideo(screenStream,nick+' (screen)')};
function addVideo(stream,label){const videoCard=document.createElement('div');videoCard.className='video-card';const videoEl=document.createElement('video');videoEl.srcObject=stream;videoEl.autoplay=true;videoEl.muted=(label===nick);const span=document.createElement('span');span.textContent=label;videoCard.appendChild(videoEl);videoCard.appendChild(span);videoPanel.appendChild(videoCard);}
</script>
</body>
</html>
